name: DUSK/USDT Multi-Exchange Monitor

on:
  workflow_dispatch:

jobs:
  monitor:
    name: 執行監控
    runs-on: ubuntu-latest
    
    steps:
    - name: 檢出代碼
      uses: actions/checkout@v3
    - name: 設置Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    - name: 修復文件錯誤
      run: |
        # 完全替換dusk_monitor.py的第3行錯誤函數
        if [ -f "dusk_monitor.py" ]; then
          echo "修復 dusk_monitor.py..."
          sed -i '3s/.*/def check_single_kline_alert(kline, exchange_id, name):/' dusk_monitor.py
          # 檢查是否還有其他同類錯誤
          sed -i 's/: EnhancedKLineData//g' dusk_monitor.py
          sed -i 's/: EnhancedKlineData//g' dusk_monitor.py
        fi
    - name: 運行監控
      run: |
        echo "檢查文件狀態..."
        head -10 dusk_monitor.py
        python dusk_monitor.py
