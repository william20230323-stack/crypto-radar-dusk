name: æ¸¬è©¦ Telegram é€šçŸ¥

on:
  workflow_dispatch:

jobs:
  test-telegram:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ¸¬è©¦ Telegram é€£ç·š
        env:
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          echo "ğŸ” é–‹å§‹æ¸¬è©¦ Telegram é€šçŸ¥..."
          echo "TG_TOKEN é•·åº¦: ${#TG_TOKEN}"
          echo "TG_CHAT_ID: $TG_CHAT_ID"
          
          # æ¸¬è©¦æ–¹æ³•1ï¼šä½¿ç”¨ curl
          echo "ğŸ”„ æ¸¬è©¦æ–¹æ³•1ï¼šä½¿ç”¨ curl"
          curl_status=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST "https://api.telegram.org/bot$TG_TOKEN/sendMessage" \
            -d chat_id="$TG_CHAT_ID" \
            -d text="âœ… æ¸¬è©¦é€šçŸ¥ï¼šTelegram é€£æ¥æˆåŠŸ")
          
          echo "Curl ç‹€æ…‹ç¢¼: $curl_status"
          
          # æ¸¬è©¦æ–¹æ³•2ï¼šä½¿ç”¨ Python
          echo "ğŸ”„ æ¸¬è©¦æ–¹æ³•2ï¼šä½¿ç”¨ Python"
          python3 -c "
          import requests, os, json
          token = os.getenv('TG_TOKEN')
          chat_id = os.getenv('TG_CHAT_ID')
          
          print(f'Token å‰10ä½: {token[:10] if token else \"ç„¡\"}...')
          print(f'Chat ID: {chat_id}')
          
          if token and chat_id:
              # æ¸¬è©¦ Bot Token æ˜¯å¦æœ‰æ•ˆ
              print('ğŸ” æ¸¬è©¦ Bot Token...')
              test_url = f'https://api.telegram.org/bot{token}/getMe'
              try:
                  r = requests.get(test_url, timeout=10)
                  print(f'Bot æ¸¬è©¦ç‹€æ…‹ç¢¼: {r.status_code}')
                  if r.status_code == 200:
                      print('âœ… Bot Token æœ‰æ•ˆ')
                      bot_info = r.json()
                      print(f'Bot åç¨±: {bot_info[\"result\"][\"first_name\"]}')
                      print(f'Bot ç”¨æˆ¶å: @{bot_info[\"result\"][\"username\"]}')
                  else:
                      print(f'âŒ Bot Token ç„¡æ•ˆ: {r.text}')
              except Exception as e:
                  print(f'âŒ é€£æ¥éŒ¯èª¤: {e}')
              
              # ç™¼é€æ¸¬è©¦è¨Šæ¯
              print('ğŸ“¤ ç™¼é€æ¸¬è©¦è¨Šæ¯...')
              url = f'https://api.telegram.org/bot{token}/sendMessage'
              data = {
                  'chat_id': chat_id,
                  'text': 'ğŸ”” é€™æ˜¯ä¸€æ¢æ¸¬è©¦é€šçŸ¥\nä¾†è‡ª GitHub Actions\nå¦‚æœæ”¶åˆ°è«‹å›è¦† OK',
                  'parse_mode': 'HTML'
              }
              try:
                  r = requests.post(url, json=data, timeout=10)
                  print(f'ç™¼é€ç‹€æ…‹ç¢¼: {r.status_code}')
                  if r.status_code == 200:
                      print('âœ… æ¸¬è©¦è¨Šæ¯ç™¼é€æˆåŠŸï¼')
                      print('ğŸ“± è«‹æª¢æŸ¥ Telegram æ˜¯å¦æ”¶åˆ°è¨Šæ¯')
                  else:
                      print(f'âŒ ç™¼é€å¤±æ•—: {r.text}')
              except Exception as e:
                  print(f'âŒ ç™¼é€éŒ¯èª¤: {e}')
          else:
              print('âŒ ç¼ºå°‘ TG_TOKEN æˆ– TG_CHAT_ID')
          "
